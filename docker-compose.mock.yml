version: '3.8'

services:
  auth:
    image: stoplight/prism:latest
    container_name: skeldir-mock-auth
    ports:
      - "4010:4010"
    volumes:
      - ./api-contracts/openapi/v1:/contracts:ro
    environment:
      - PRISM_ERRORS=true
    command: prism mock /contracts/auth.yaml -p 4010 -h 0.0.0.0
    healthcheck:
      test: ["CMD", "sh", "-c", "curl -f -X POST http://localhost:4010/api/auth/login -H 'Content-Type: application/json' -H 'X-Correlation-ID: test' -d '{\"email\":\"test@example.com\",\"password\":\"test\"}' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 2
      start_period: 30s

  attribution:
    image: stoplight/prism:latest
    container_name: skeldir-mock-attribution
    ports:
      - "4011:4011"
    volumes:
      - ./api-contracts/openapi/v1:/contracts:ro
    environment:
      - PRISM_ERRORS=true
    command: prism mock /contracts/attribution.yaml -p 4011 -h 0.0.0.0
    healthcheck:
      test: ["CMD", "sh", "-c", "curl -f http://localhost:4011/api/attribution/revenue/realtime -H 'Authorization: Bearer mock' -H 'X-Correlation-ID: test' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 2
      start_period: 30s

  reconciliation:
    image: stoplight/prism:latest
    container_name: skeldir-mock-reconciliation
    ports:
      - "4012:4012"
    volumes:
      - ./api-contracts/openapi/v1:/contracts:ro
    environment:
      - PRISM_ERRORS=true
    command: prism mock /contracts/reconciliation.yaml -p 4012 -h 0.0.0.0

  export:
    image: stoplight/prism:latest
    container_name: skeldir-mock-export
    ports:
      - "4013:4013"
    volumes:
      - ./api-contracts/openapi/v1:/contracts:ro
    environment:
      - PRISM_ERRORS=true
    command: prism mock /contracts/export.yaml -p 4013 -h 0.0.0.0

  health:
    image: stoplight/prism:latest
    container_name: skeldir-mock-health
    ports:
      - "4014:4014"
    volumes:
      - ./api-contracts/openapi/v1:/contracts:ro
    environment:
      - PRISM_ERRORS=true
    command: prism mock /contracts/health.yaml -p 4014 -h 0.0.0.0
    healthcheck:
      test: ["CMD", "sh", "-c", "curl -f http://localhost:4014/api/health || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s

  webhooks-shopify:
    image: stoplight/prism:latest
    container_name: skeldir-mock-webhooks-shopify
    ports:
      - "4015:4015"
    volumes:
      - ./api-contracts/openapi/v1:/contracts:ro
    environment:
      - PRISM_ERRORS=true
    command: prism mock /contracts/webhooks/shopify.yaml -p 4015 -h 0.0.0.0

  webhooks-woocommerce:
    image: stoplight/prism:latest
    container_name: skeldir-mock-webhooks-woocommerce
    ports:
      - "4016:4016"
    volumes:
      - ./api-contracts/openapi/v1:/contracts:ro
    environment:
      - PRISM_ERRORS=true
    command: prism mock /contracts/webhooks/woocommerce.yaml -p 4016 -h 0.0.0.0

  webhooks-stripe:
    image: stoplight/prism:latest
    container_name: skeldir-mock-webhooks-stripe
    ports:
      - "4017:4017"
    volumes:
      - ./api-contracts/openapi/v1:/contracts:ro
    environment:
      - PRISM_ERRORS=true
    command: prism mock /contracts/webhooks/stripe.yaml -p 4017 -h 0.0.0.0

  webhooks-paypal:
    image: stoplight/prism:latest
    container_name: skeldir-mock-webhooks-paypal
    ports:
      - "4018:4018"
    volumes:
      - ./api-contracts/openapi/v1:/contracts:ro
    environment:
      - PRISM_ERRORS=true
    command: prism mock /contracts/webhooks/paypal.yaml -p 4018 -h 0.0.0.0


