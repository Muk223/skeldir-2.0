# v1.1.0 Model Regeneration Required

**Status**: Contracts updated to v1.1.0  
**Date**: 2024-01-15  
**Action Required**: Regenerate Pydantic models from hardened contracts

---

## Contract Changes Summary

All 9 contracts have been updated from v1.0.0 to v1.1.0 with the following non-breaking changes:

### Additive Changes (Non-Breaking)
- **New webhook operations** (refunds, order paid events)
- **Optional Bayesian fields** in attribution response (credible_interval_lower/upper)
- **Cache headers** in attribution 200 responses
- **Retry-After header** in 429 responses
- **Governance metadata** (x-version-history)

### Type Hardening (Breaking for unconstrained cases, but corrective)
- **attribution.yaml**: `total_revenue` changed from `string` to `number` with `minimum: 0`
- **All currency fields**: Added pattern constraints (`^[A-Z]{3}$` or `^[a-z]{3}$` for Stripe)
- **All monetary fields**: Added `minimum: 0` constraint
- **Timestamp fields**: Enforced `format: date-time`
- **ID fields**: Enforced `format: uuid` where applicable

---

## Model Regeneration Command

```bash
chmod +x scripts/generate-models.sh
bash scripts/generate-models.sh
```

This will:
1. Bundle all v1.1.0 contracts
2. Generate Pydantic models to `backend/app/schemas/`
3. Validate models are non-trivial (class count, file size checks)

---

## Expected Model Changes

### New Models
- **Stripe**: `StripeChargeRefundedRequest`, `StripePaymentIntentSucceededRequest`
- **Shopify**: `ShopifyOrderPaidRequest`, `ShopifyRefundCreateRequest`
- **WooCommerce**: `WooCommerceOrderCompletedRequest`, `WooCommerceOrderRefundedRequest`
- **PayPal**: `PayPalSaleRefundedRequest`

### Modified Models
- **RealtimeRevenueResponse**:
  - `total_revenue`: `str` → `float` (with `minimum=0` validator)
  - Added optional: `upgrade_notice: str`
  - Added optional: `credible_interval_lower: float`
  - Added optional: `credible_interval_upper: float`

### Hardened Constraints
All currency fields now have pattern validators matching invariant registry specifications.

---

## Validation Steps

After regeneration, verify:

1. **Model generation succeeds**:
   ```bash
   python scripts/governance/validate-invariants.py --verbose
   ```

2. **Coverage manifest updated**:
   - Mark new operations as "implemented" in `governance/coverage-manifest.yaml`
   - Run `python scripts/governance/validate-coverage.py`

3. **CI pipeline passes**:
   - Spectral linting (ownership + invariant rules)
   - Coverage validation
   - Invariant validation
   - OpenAPI structural validation

4. **Breaking change check**:
   ```bash
   # Should pass - all changes are additive or corrective
   oasdiff breaking api-contracts/baselines/v1.0.0/ api-contracts/openapi/v1/
   ```

---

## Semantic Completeness Achieved

The v1.1.0 contracts now encode:

✅ **All domain invariants** from `governance/invariants.yaml`  
✅ **All operational policies** from `governance/policies.yaml`  
✅ **Critical webhook coverage** for B2.4 reconciliation (refund events)  
✅ **Behavioral semantics** (rate limits, cache headers, Retry-After)  
✅ **Ownership traceability** (x-domain, x-owner metadata)  

**Contracts are now the complete source of truth**, not the registries.

---

## Next Steps

1. Run model regeneration command
2. Update backend code to use new models
3. Update coverage manifest to mark new operations as "implemented"
4. Run full governance validation suite
5. Create v1.1.0 baseline for future breaking change detection

---

**Note**: Model regeneration MUST be performed before any backend implementation of the new webhook endpoints or Bayesian attribution features.





