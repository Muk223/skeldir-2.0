# Test Expectation: Stripe Charge Succeeded (Valid)
# Payload: stripe_charge_succeeded_valid.json
# Purpose: Proves basic PaymentCaptured mapping works end-to-end

test_id: "stripe_charge_succeeded_valid_001"
test_type: "happy_path"
canonical_event: "PaymentCaptured"

input_payload_file: "stripe_charge_succeeded_valid.json"

expected_ledger_state:
  revenue_ledger:
    - transaction_id: "ch_3QACppAtHEbrEuTI0Hm3lVxG"
      order_id: null  # charge.succeeded doesn't provide order_id
      amount_cents: 10000
      currency: "USD"  # TRANSFORM TEST: lowercase 'usd' -> uppercase 'USD'
      state: "captured"
      verification_source: "stripe_webhook"
      verification_timestamp: "2021-01-01T00:00:00Z"  # TRANSFORM TEST: unix 1609459200 -> ISO8601
      
  revenue_state_transitions:
    - transaction_id: "ch_3QACppAtHEbrEuTI0Hm3lVxG"
      from_state: "authorized"
      to_state: "captured"
      transition_timestamp: "2021-01-01T00:00:00Z"

expected_dead_events_count: 0

behavioral_assertions:
  - assertion: "currency_uppercase_transform"
    description: "Input 'usd' (lowercase) must become 'USD' (uppercase) in ledger"
    input_value: "usd"
    expected_output_value: "USD"
    
  - assertion: "unix_timestamp_transform"
    description: "Unix timestamp 1609459200 must become '2021-01-01T00:00:00Z'"
    input_value: 1609459200
    expected_output_value: "2021-01-01T00:00:00Z"
  
  - assertion: "state_transition_occurred"
    description: "Must create exactly ONE transition from 'authorized' to 'captured'"
    expected_transition_count: 1





